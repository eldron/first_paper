!function(){function a(a){switch(a){case"p0":break;case"p1":b(),c(),g();break;case"product/schedule":}}function b(){}function c(){d(),e(),f()}function d(){try{$L("module.compose.Compose");var a=$L("support.AddressSupport")}catch(b){return b}var c=$.Object;$.Email;var d=$.Ext,e=$.Log;$.S_OK;var f=$.Ud;$.Uri;var g=$.getClass($N("module.compose.ComposeBase"));g.prototype.send=function(b){var g=this,h=g.module,i=g.attach,j=g.data,k=g.info;if(g.sendCheck(b)&&"success"!=j.get({status:"curPage"})){if(j.get({component:"autoSendTips"}))try{j.get({component:"autoSendTips"}).hide()}catch(l){}var m={},n={action:b.action},o=k.get({cid:!0});if(o&&(m.id=o),"verify"==b.action)m.verifyCode=b.code;else{var p=m.attrs=g.sendBuild(b);g.info.set({obj:p}),g.info.set({con:[].concat(p.to,p.cc,p.bcc)})}m.returnInfo="deliver"==b.action||"schedule"==b.action||"verify"==b.action?!1:!0;var q=b.action;if("auto"==b.action||"force"==b.action?q="save":"verify"==b.action&&(q="deliver",j.get({status:"showSchedule"})&&(b.action=q="schedule")),m.action=q,g.attach.fileHas({type:"link"})&&(m.flagLinkAttached=!0),"deliver"==b.action&&0===$S("attrs").user.save_sent){var r=i.fileGet({context:!0});r&&r.length||(m.saveTextThreshold=j.saveTextThreshold)}if("deliver"==b.action&&1==$S("attrs").user.aftersend_saveaddr)try{$.Array.each(g.info.get({con:!0}),function(b,c){var d=c.replace(/^.*<|>$/g,"").toLowerCase();return a.data.extDataMap.email[d]?void 0:(m.autosaveRcptsMode="add",$.BREAK)})}catch(l){}if("schedule"==b.action&&"0"==f.get({field:"ntes_option",flag:"schedule_notify"})&&(m.notifyEML=!0),"deliver"==b.action&&j.get({status:"showEncrypt"})&&(m.encryptPassword=h.encrypt.get(),h.encrypt.get({save:!0})&&(m.savePassword=!0,m.attrs.saveSentCopy=!0,delete m.saveTextThreshold)),d.ynote&&g.form.getCheckbox("ynote")&&(j.set({status:"save2YNote",value:!0}),m.attrs.saveSentCopy=!0,delete m.saveTextThreshold,e.cache({cl_ynote:"1"},$.EMPTYFUNC)),d.notary&&j.get({status:"showNotary"})&&(0===h.notary.userpro&&(m.attrs.saveSentCopy=!0),h.notary.status.useSign&&(m.attrs.content+='<div style="height:42px;line-height:42px;font-size:16px;text-align:center"><div style="font-family:\'楷体\', \'楷体_GB2312\'"><span style="color:#CC0000">★</span> 此邮件已被 <a href="http://gzy.mail.163.com/?from=mailread" style="text-decoration:none" target="_blank"><strong style="color:#CC0000">网易公正邮</strong></a> 保全存证，发件人承诺与您诚信沟通！ <span style="color:#CC0000">★</span></div></div>')),"deliver"==b.action&&"1"==f.get({field:"ntes_compose",flag:"undo_send"})&&(m.delayTime=j.delayTime),"deliver"==b.action||"schedule"==b.action){c.extend(n,g.log),j.get({status:"useSign"})&&(n.sign="1"),j.get({status:"showEncrypt"})&&(n.encrypt="1");var s=j.get({status:"fromEntry"});"compose"!=s&&(n.from=s),"shortcut"==b.source&&(n.cl_st=1)}b.body=m,j.set({status:"sendParam",value:b}),g.action.send({body:m,log:n,callback:$.Function.bind(g.sendSuccess,g),error:$.Function.bind(g.sendError,g)});var t="";switch(b.action){case"deliver":t="正在发送邮件...";break;case"schedule":t="正在保存定时发信...";break;case"save":t="正在保存邮件...";break;case"auto":case"force":t="正在自动保存草稿...";break;case"verify":t="正在进行验证码核对并发送邮件..."}t&&g.tips(t)}},g.prototype.sendCheck=function(a){var b=this,c=b.module,d=b.data,e=b.editor,f=b.form,g=b.attach,h=a.action;if("verify"==h)return!0;if("auto"==h){var i=e.getFinal();if(""===i)return!1}if("auto"!=h&&"force"!=h&&!b.checkRepeatSend())return!1;if("force"!=h){var j=d.get({status:"fromEntry"});if(("edit"==j||"draft"==j||"timeset"==j||"reply"==j||"forward"==j)&&""===b.info.get({cid:!0}))return"auto"==h||$.Msgbox.show({title:"您的信件正在加载中，请稍候！"}),!1}if(("deliver"==h||"save"==h)&&d.get({status:"showSchedule"})){if(!b.module.schedule.verify())return!1;h=a.action="schedule"}if("deliver"==h||"schedule"==h){if(!b.checkSenderName(a))return!1;if(!b.checkRev(a))return!1;if(!b.checkSubject(a))return!1;if(d.get({status:"showEncrypt"})&&!c.encrypt.verify())return!1;if(!b.checkAttachText(a))return!1;if(f.getCheckbox("chargesms"))try{var c=b.module,k=c.smsNotify,l=k.checkData();if(!l)return!1;d.set({status:"chargeSmsData",value:l})}catch(m){$D.debug("chargesms Error"+m)}}if("deliver"==h||"schedule"==h||"verify"==h||"save"==h){if(g.fileIsPost())return b.setSequence("postResult",function(){b.send(a)}),g.postUpload(),!1;if(g.fileIsUpload()){if(b.setSequence("uploadResult",function(){b.send(a)}),"save"==h)b.tips("正在上传附件，上传完成后将自动保存到草稿箱");else{var n={items:[{html:"<span>正在上传附件，上传完成后将自动发送 </span>"},{xtype:"link",bracket:!0,text:"取消自动发送",click:function(){delete d.sequence.uploadResult,this.destroy(),b.tips()}}]};b.tips(n)}return!1}if(g.fileIsError())return g.validLocal(),b.tips(""),!1;if(g.get({status:"validServer"}))return g.set({status:"validServer",value:!1}),g.validServer(h),!1}return!0}}function e(){try{$L("module.compose.Compose");var a=$L("component.editor.Editor")}catch(b){return b}$.Object,$.Function,$.Browser,$.Ext,$.Log;var c=$.Ud,d=$.getClass($N("module.compose.ComposeEditor"));d.prototype.render=function(){var b=this;b.module;var d=b.data,e=d.layout;e.editorHeight;var f=a.mode.BASIC;1==c.get({field:"ntes_letter",flag:"editorToolbar"})&&(f=a.mode.FULL),2==c.get({field:"ntes_htmlbar"})&&(b.mode=f);var g=d.get({component:"editor"});b.editorCmpt=g,g.composeEditor=b,b.custom(),b.bindEvent(),"0"==c.get({field:"ntes_compose",flag:"editor_notary_tips"})&&(1==c.get({field:"ntes_letter",flag:"editorToolbar"})||2==c.get({field:"ntes_htmlbar"})||setTimeout(function(){b.showLayer()},1e3))}}function f(){try{$L("module.compose.Compose")}catch(a){return a}$.Object,$.Function,$.Browser,$.Ext,$.Log,$.Ud;var b=$.getClass($N("module.compose.ComposeAttach"));b.prototype.validServer=function(a){var b=this,c=b.info.get({cid:!0});b.action.syncAttach({cid:c,callback:function(c){var d={state:"success",cloud:!1},e=b.fileGet(d),f=c["var"].attachments,g=[];$.Array.each(f,function(a,b){var c=!1;$.Array.each(e,function(a,d){return b.id==d.sid?(c=!0,$.BREAK):void 0}),c||g.push(b.id)}),g.length>0?b.action.deleteAttach({sid:g,callback:function(a){a.code==S_OK&&b.base.send({action:"deliver"})}}):b.base.send({action:a})}})}}function g(){var a=$.getClass($N("module.read.MailReaderAssistant")),b=$I("init.SenderList");a.prototype.loadMailServiceContent=function(a){var c=this,d=c.reader;d.module.action.getMailServiceData({uid:b.getUid().address,sender:d.localSender[0].address,time:(d.view.getDateStr(null,null,!0)||new Date).getTime(),call:function(b){var c=$.JSON.parse(b.responseText);if(c.code===$.S_OK){var e=d.getDom("mailService");e.firstChild.innerHTML=c["var"].html,e.style.display="",a&&a()}}})}}$Fix.fix=a}(window);